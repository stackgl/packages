{"readme":"<h1 class=\"title\"><a target=\"_blank\" href=\"https://github.com/mikolalysenko/3d-camera-core\">3d-camera-core</a><div class=\"contrib\"></div></h1>\n<p>A common interface for 3D cameras.  This module is a caching layer for maintaining coordinate system transformations and computing camera properties from a set of generating matrices. This module is intended to be used as a common interface and should not be required directly.</p>\n<h3 id=\"notes-on-coordinates\">Notes on coordinates</h3>\n<p>By convention, we will define 4 different 3 dimensional projective homogeneous coordinate systems:</p>\n<ul>\n<li><strong>Data coordinates</strong>: The coordinates used by models and 3D data</li>\n<li><strong>World coordinates</strong>: A common coordinate system for all objects within the scene</li>\n<li><strong>Camera coordinates</strong>: The coordinate system in the world where the camera is at the center</li>\n<li><strong>Clip coordinates</strong>: The device clip coordinate system</li>\n</ul>\n<p>These coordinates are related by a set of three homogeneous 4x4 matrices:</p>\n<ul>\n<li><strong>Model matrix</strong>: Maps data coordinates to world coordinates</li>\n<li><strong>View matrix</strong>: Maps world coordinates to camera coordinates</li>\n<li><strong>Projection matrix</strong>: Maps view coordinates to device clip coordinates</li>\n</ul>\n<p>The goal of this module is to maintain the relationships between these coordinate systems as matrices and to define a standard interface for renderable objects which need to consume camera information.  Implementors should take this module and hook up whatever methods they want to compute the model/view/projection matrices, while users can then treat the resulting camera interface as a black box handling the various coordinate system conversions.</p>\n<h2 id=\"user-side\">User side</h2>\n<p>For most users of this module, you only need to worry about the stuff in this section.</p>\n<h2 id=\"user-example\">User example</h2>\n<pre><code class=\"lang-javascript\"><div class=\"line\"><span class=\"source js\"><span>//You&#xA0;should&#xA0;call&#xA0;some&#xA0;other&#xA0;module&#xA0;to&#xA0;create&#xA0;a&#xA0;camera&#xA0;controller</span></span></div><div class=\"line\"><span class=\"source js\"><span>var&#xA0;myCamera&#xA0;=&#xA0;createCameraType()</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span>//Once&#xA0;you&#xA0;have&#xA0;a&#xA0;camera,&#xA0;then&#xA0;you&#xA0;can&#xA0;access&#xA0;the&#xA0;coordinate&#xA0;conversions&#xA0;directly</span></span></div><div class=\"line\"><span class=\"source js\"><span>var&#xA0;dataToClip&#xA0;=&#xA0;myCamera.data.toClip</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span>//You&#xA0;can&#xA0;also&#xA0;access&#xA0;the&#xA0;origin&#xA0;of&#xA0;the&#xA0;camera&#xA0;in&#xA0;any&#xA0;coordinate&#xA0;system&#xA0;too</span></span></div><div class=\"line\"><span class=\"source js\"><span>var&#xA0;eyePosition&#xA0;=&#xA0;myCamera.world.origin</span></span></div>\n</code></pre>\n<h2 id=\"user-api\">User API</h2>\n<p>The overall goal of this module is to keep track of conversions between a number of different coordinate systems.  Because multiplying and recalculating these conversions is expensive, this module caches this data for future use.  After a camera object has been created, no further memory allocations are performed.</p>\n<h3 id=\"coordinate-system-conversions\">Coordinate system conversions</h3>\n<p>The most basic function of this module is to provide a convenient syntax for getting whatever camera transformations you need.</p>\n<h4 id=\"coords-toclip\"><code>coords.toClip</code></h4>\n<p>A 4x4 matrix representing the conversion from <code>coords</code> into clip coordinates.</p>\n<h4 id=\"coords-tocamera\"><code>coords.toCamera</code></h4>\n<p>A 4x4 matrix representing the conversion from <code>coords</code> into camera coordinates.</p>\n<h4 id=\"coords-toworld\"><code>coords.toWorld</code></h4>\n<p>A 4x4 matrix representing the conversion from <code>coords</code> into world coordinates</p>\n<h4 id=\"coords-todata\"><code>coords.toData</code></h4>\n<p>A 4x4 matrix representing the conversion from <code>coords</code> into data coordinates.</p>\n<h3 id=\"origin\">Origin</h3>\n<h4 id=\"coords-origin\"><code>coords.origin</code></h4>\n<p>The position of the camera in the coordinate system.</p>\n<h2 id=\"for-implementors\">For implementors</h2>\n<p>A camera implementation should provide one or more &quot;controllers&quot; for each of the model, view and projection matrices.  Each controller is an object with two methods; one which tests if the controller has changed and one which reads out the state of the matrix for the controller.</p>\n<h2 id=\"implementation-example\">Implementation example</h2>\n<pre><code class=\"lang-javascript\"><div class=\"line\"><span class=\"source js\"><span>var&#xA0;createCamera&#xA0;=&#xA0;require(&apos;3d-camera-core&apos;)</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span>//A&#xA0;simple&#xA0;implementation&#xA0;of&#xA0;a&#xA0;camera&#xA0;controller</span></span></div><div class=\"line\"><span class=\"source js\"><span>function&#xA0;simpleController()&#xA0;{</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;var&#xA0;data&#xA0;=&#xA0;[1,0,0,0,</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;0,1,0,0,</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;0,0,1,0,</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;0,0,0,1]</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;var&#xA0;isDirty&#xA0;=&#xA0;false</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;return&#xA0;{</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;dirty:&#xA0;function()&#xA0;{</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;isDirty</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;},</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;get:&#xA0;function(m)&#xA0;{</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;isDirty&#xA0;=&#xA0;false</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;for(var&#xA0;i=0;&#xA0;i&lt;16;&#xA0;++i)&#xA0;{</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;m[i]&#xA0;=&#xA0;data[i]</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;},</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;set:&#xA0;function(m)&#xA0;{</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;isDirty&#xA0;=&#xA0;true</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;for(var&#xA0;i=0;&#xA0;i&lt;16;&#xA0;++i)&#xA0;{</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;data[i]&#xA0;=&#xA0;m[i]</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;&#xA0;&#xA0;}</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;}</span></span></div><div class=\"line\"><span class=\"source js\"><span>}</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span>//Create&#xA0;a&#xA0;set&#xA0;of&#xA0;controllers&#xA0;for&#xA0;the&#xA0;camera&#xA0;object</span></span></div><div class=\"line\"><span class=\"source js\"><span>var&#xA0;controllers&#xA0;=&#xA0;{</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;model:&#xA0;simpleController(),</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;view:&#xA0;simpleController(),</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;&#xA0;projection:&#xA0;simpleController()</span></span></div><div class=\"line\"><span class=\"source js\"><span>}</span></span></div><div class=\"line\"><span class=\"source js\"><span>&#xA0;</span></span></div><div class=\"line\"><span class=\"source js\"><span>//Return&#xA0;camera</span></span></div><div class=\"line\"><span class=\"source js\"><span>var&#xA0;camera&#xA0;=&#xA0;createCamera(controllers)</span></span></div>\n</code></pre>\n<h2 id=\"implementor-api\">Implementor API</h2>\n<h3 id=\"constructor\">Constructor</h3>\n<h4 id=\"var-camera-createcamera-controllers-\"><code>var camera = createCamera(controllers)</code></h4>\n<p>This creates a new camera object with the given controllers.  <code>controllers</code> is an object with the following properties:</p>\n<ul>\n<li><code>controllers.model</code> a controller for the model matrix</li>\n<li><code>controllers.view</code> a controller for view matrix</li>\n<li><code>controllers.projection</code> a controller for the projection matrix</li>\n</ul>\n<p><strong>Returns</strong> A new camera object</p>\n<h3 id=\"controller-interface\">Controller interface</h3>\n<p>Each controller is an object which provides two methods:</p>\n<h4 id=\"controller-dirty-\"><code>controller.dirty()</code></h4>\n<p>This method should test if the state of the controller has changed since the last time <code>controller.get()</code> was called.  If it has, then the matrix value will be recomputed.</p>\n<p><strong>Returns</strong> <code>true</code> if the camera matrix has changed, otherwise <code>false</code></p>\n<h4 id=\"controller-get-matrix-\"><code>controller.get(matrix)</code></h4>\n<p>This retrieves the state of the controller&apos;s matrix.  The result should be written into <code>matrix</code></p>\n<h3 id=\"methods\">Methods</h3>\n<h4 id=\"camera-setcontroller-matrix-controller-\"><code>camera.setController(matrix, controller)</code></h4>\n<p>Replaces the controller on the camera for <code>matrix</code> with <code>controller</code>.</p>\n<ul>\n<li><code>matrix</code> is the name of the matrix, which is either <code>model</code>, <code>view</code> or <code>projection</code></li>\n<li><code>controller</code> is the new controller for the matrix</li>\n</ul>\n<h2 id=\"legal\">Legal</h2>\n<p>(c) 2015 Mikola Lysenko.  MIT License</p>\n"}